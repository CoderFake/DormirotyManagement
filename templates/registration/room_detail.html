{% extends 'base.html' %}

{% block title %}Chi tiết phòng {{ room.building.name }} - {{ room.room_number }} - Quản lý Ký túc xá{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-lg-5">
                    {% if room.image %}
                        <img src="{{ room.image.url }}" class="img-fluid rounded" alt="{{ room.building.name }} - {{ room.room_number }}">
                    {% else %}
                        <div class="bg-light d-flex justify-content-center align-items-center rounded" style="height: 300px;">
                            <i class="fas fa-home fa-5x text-secondary"></i>
                        </div>
                    {% endif %}

                    <div class="mt-3">
                        {% if can_register and room.status != 'fully_occupied' and room.status != 'maintenance' %}
                            <a href="{% url 'registration:apply_with_room' room.id %}" class="btn btn-primary btn-lg w-100">
                                <i class="fas fa-file-signature me-1"></i> Đăng ký phòng này
                            </a>
                        {% elif not can_register %}
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i> Bạn hiện không thể đăng ký phòng mới do đã có đơn đăng ký hoặc đang có hợp đồng.
                            </div>
                        {% elif room.status == 'fully_occupied' %}
                            <div class="alert alert-danger">
                                <i class="fas fa-ban me-2"></i> Phòng này đã đầy chỗ.
                            </div>
                        {% elif room.status == 'maintenance' %}
                            <div class="alert alert-info">
                                <i class="fas fa-tools me-2"></i> Phòng này đang được bảo trì.
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-lg-7">
                    <h3 class="mb-3">{{ room.building.name }} - Phòng {{ room.room_number }}</h3>

                    <div class="mb-3">
                        {% if room.status == 'available' %}
                            <span class="badge bg-success">Còn trống</span>
                        {% elif room.status == 'partially_occupied' %}
                            <span class="badge bg-warning">Còn chỗ</span>
                        {% elif room.status == 'fully_occupied' %}
                            <span class="badge bg-danger">Đã đầy</span>
                        {% elif room.status == 'maintenance' %}
                            <span class="badge bg-info">Đang bảo trì</span>
                        {% endif %}
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <h5 class="mb-3">Thông tin cơ bản</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th>Tòa nhà</th>
                                    <td>{{ room.building.name }}</td>
                                </tr>
                                <tr>
                                    <th>Tầng</th>
                                    <td>{{ room.floor }}</td>
                                </tr>
                                <tr>
                                    <th>Loại phòng</th>
                                    <td>{{ room.room_type.name }}</td>
                                </tr>
                                <tr>
                                    <th>Sức chứa</th>
                                    <td>{{ room.room_type.capacity }} người</td>
                                </tr>
                                <tr>
                                    <th>Diện tích</th>
                                    <td>{{ room.room_type.area }} m²</td>
                                </tr>
                                <tr>
                                    <th>Số chỗ còn trống</th>
                                    <td>{{ room.get_available_beds }} chỗ</td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h5 class="mb-3">Thông tin chi phí</h5>
                            <table class="table table-bordered">
                                <tr>
                                    <th>Giá phòng</th>
                                    <td>{{ room.room_type.price_per_month|floatformat:0 }} VNĐ/tháng</td>
                                </tr>
                                <tr>
                                    <th>Đặt cọc</th>
                                    <td>{{ room.room_type.deposit|floatformat:0 }} VNĐ</td>
                                </tr>
                                <tr>
                                    <th>Điện</th>
                                    <td>Theo chỉ số sử dụng</td>
                                </tr>
                                <tr>
                                    <th>Nước</th>
                                    <td>Theo chỉ số sử dụng</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-12">
                            <h5 class="mb-3">Mô tả</h5>
                            <div class="p-3 border rounded">
                                {% if room.description %}
                                    {{ room.description|linebreaks }}
                                {% else %}
                                    <p class="text-muted mb-0">Chưa có mô tả chi tiết</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    {% if room_amenities %}
                        <div class="mb-3">
                            <h5 class="mb-3">Tiện nghi phòng</h5>
                            <div class="row">
                                {% for amenity in room_amenities %}
                                    <div class="col-md-4 mb-2">
                                        <div class="d-flex align-items-center">
                                            {% if amenity.amenity.icon %}
                                                <i class="fas {{ amenity.amenity.icon }} me-2 text-primary"></i>
                                            {% else %}
                                                <i class="fas fa-check me-2 text-primary"></i>
                                            {% endif %}
                                            <span>{{ amenity.amenity.name }} ({{ amenity.quantity }})</span>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}

                    {% if available_beds %}
                        <div class="mb-3">
                            <h5 class="mb-3">Giường trống</h5>
                            <div class="row">
                                {% for bed in available_beds %}
                                    <div class="col-md-3 mb-2">
                                        <div class="border p-2 rounded text-center">
                                            <i class="fas fa-bed text-primary mb-2"></i>
                                            <p class="mb-0">Giường {{ bed.bed_number }}</p>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-between">
        <a href="{% url 'registration:room_list' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-1"></i> Quay lại danh sách phòng
        </a>

        {% if can_register and room.status != 'fully_occupied' and room.status != 'maintenance' %}
            <a href="{% url 'registration:apply_with_room' room.id %}" class="btn btn-primary">
                <i class="fas fa-file-signature me-1"></i> Đăng ký phòng này
            </a>
        {% endif %}
    </div>
</div>
{% endblock %}